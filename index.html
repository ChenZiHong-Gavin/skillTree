<!doctype html>
<html>
<head>
<meta charset="utf-8"/>
<title>滑板技能树</title>
<link rel="shortcut icon" href="./img/logo.png">
<style>

/* Less （Leaner Style Sheets 的缩写） 是一门向后兼容的 CSS 扩展语言。
包含了 Less 语言以及利用 JavaScript 开发的用于将 Less 样式转换成 CSS 样式的 Less.js 工具。 */
/*---------------------------------------------------
    LESS Elements 0.9
  ---------------------------------------------------
    A set of useful LESS mixins
    More info at: http://lesselements.com
  ---------------------------------------------------*/


/* y轴多余部分以滑动形式展现 */
html {
    overflow-y: scroll;
}
body {
    margin: 0;
    padding: 0;
    color: #eee;
    background: #000 url(img/bg.jpg) top center no-repeat;
    font-family: Arial, Helvetica, sans-serif;
    font-size: 12px;
    line-height: 1.5em;
}
header {
    position: relative;
    z-index: 20;
    font-family: 'Microsoft YaHei', Georgia, 'Times New Roman', Times, serif;
    font-size: 20px;
    margin: 30px 0px 30px 0px;
    text-align: center;
}

button {
    border: 1px solid #fbf287;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
    -webkit-box-shadow: 0 6px 11px #000;
    -moz-box-shadow: 0 6px 11px #000;
    box-shadow: 0 6px 11px #000;
    background: #debd4c;
    background: -webkit-gradient(linear, left bottom, left top, color-stop(0, #c38f1f), color-stop(1, #faed7c));
    background: -ms-linear-gradient(bottom, #c38f1f, #faed7c);
    background: -moz-linear-gradient(center bottom, #c38f1f 0%, #faed7c 100%);
    background: -o-linear-gradient(#faed7c, #c38f1f);
    filter: progid: DXImageTransform.Microsoft.gradient(startColorstr='#faed7c', endColorstr='#c38f1f', GradientType=0);
    font-weight: bold;
    font-size: 1.5em;
    line-height: 1em;
    padding: 0.5em 0.75em;
    cursor: pointer;
    color: #510;
}
img {
    border: 0 none;
}
a {
    color: #fe9;
}
hr {
    border: 0;
    height: 1px;
    background: #333;
}
h2,
h3,
.h2,
.h3 {
    line-height: 1.25em;
    font-weight: normal;
    margin: 0;
}
h2,
.h2 {
    font-size: 2em;
}
h3,
.h3 {
    font-size: 1.5em;
    margin-bottom: 0.25em;
}
input.h2 {
    display: block;
    border: 1px solid black;
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
    padding: 0.125em 0.25em;
    margin: -0.125em -0.25em;
    background: transparent;
    color: white;
    max-width: 100%;
    -webkit-transition: all 0.3s ease-out;
    -moz-transition: all 0.3s ease-out;
    -o-transition: all 0.3s ease-out;
    transition: all 0.3s ease-out;
}
ul {
    list-style: none;
    margin: 20px 0 0;
    padding: 0;
}
li {
    margin: 0;
    padding: 0;
}
.hide {
    display: none;
}
.page {
    margin: 0 auto;
    position: relative;
    width: 910px;
}
.talent-tree {
    width: 100%;
    height: 510px;
    -webkit-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    position: absolute;
    z-index: 10;
}
.page .talent-tree {
    -webkit-transition: all 0.3s ease-out;
    -moz-transition: all 0.3s ease-out;
    -o-transition: all 0.3s ease-out;
    transition: all 0.3s ease-out;
}
.page .talent-tree {
    -moz-opacity: 1;
    -khtml-opacity: 1;
    -webkit-opacity: 1;
    opacity: 1;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=100);
    filter: alpha(opacity=100);
    -webkit-transform: scale(1);
    -moz-transform: scale(1);
    -o-transform: scale(1);
    -ms-transform: scale(1);
    transform: scale(1);
}
.skill {
    width: 80px;
    height: 80px;
    position: absolute;
}
.skill .icon-container {
    position: absolute;
    background: black;
    width: 60px;
    height: 60px;
    padding: 5px;
    top: 5px;
    left: 5px;
    -webkit-border-radius: 8px;
    -moz-border-radius: 8px;
    border-radius: 8px;
    -webkit-box-shadow: 0 6px 11px #000;
    -moz-box-shadow: 0 6px 11px #000;
    box-shadow: 0 6px 11px #000;
    overflow: hidden;
}
.skill .icon {
    width: 100%;
    height: 100%;
    background: url(img/icon-sprite.png) no-repeat top left;
    -moz-opacity: 0.35;
    -khtml-opacity: 0.35;
    -webkit-opacity: 0.35;
    opacity: 0.35;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=35);
    filter: alpha(opacity=35);
    -webkit-transition: all 0.3s ease-out;
    -moz-transition: all 0.3s ease-out;
    -o-transition: all 0.3s ease-out;
    transition: all 0.3s ease-out;
}
.skill .frame {
    position: absolute;
    width: 100%;
    height: 100%;
    background: url(img/sprite.png) no-repeat top left;
}
.skill .frame:hover .tool-tip {
    visibility: visible;
    -moz-opacity: 1;
    -khtml-opacity: 1;
    -webkit-opacity: 1;
    opacity: 1;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=100);
    filter: alpha(opacity=100);
    -webkit-transition: all 0.3s 0.3s ease-out;
    -moz-transition: all 0.3s 0.3s ease-out;
    -o-transition: all 0.3s 0.3s ease-out;
    transition: all 0.3s 0.3s ease-out;
}
.skill .hit-area {
    position: absolute;
    width: 100%;
    height: 100%;
    cursor: pointer;
    z-index: 2;
}
.skill.can-add-points .frame {
    background-position: -80px top;
}
.skill.can-add-points .skill-dependency {
    -moz-opacity: 1;
    -khtml-opacity: 1;
    -webkit-opacity: 1;
    opacity: 1;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=100);
    filter: alpha(opacity=100);
}
.skill.has-points .icon {
    -moz-opacity: 1;
    -khtml-opacity: 1;
    -webkit-opacity: 1;
    opacity: 1;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=100);
    filter: alpha(opacity=100);
}
.skill.has-max-points .frame {
    background-position: -160px top;
}
.skill.has-max-points .skill-dependency {
    -moz-opacity: 1;
    -khtml-opacity: 1;
    -webkit-opacity: 1;
    opacity: 1;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=100);
    filter: alpha(opacity=100);
}
.skill .skill-points {
    position: absolute;
    z-index: 1;
    bottom: 5px;
    right: 5px;
    color: white;
    font-size: 11px;
    line-height: 1em;
    width: 19px;
    text-align: center;
}
.skill .tool-tip {
    visibility: hidden;
    -moz-opacity: 0;
    -khtml-opacity: 0;
    -webkit-opacity: 0;
    opacity: 0;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=0);
    filter: alpha(opacity=0);
    -webkit-border-radius: 8px;
    -moz-border-radius: 8px;
    border-radius: 8px;
    background: #000;
    position: absolute;
    z-index: 3;
    top: 5px;
    left: 80px;
    width: 300px;
    padding: 10px;
    -webkit-box-shadow: 0 6px 11px #000;
    -moz-box-shadow: 0 6px 11px #000;
    box-shadow: 0 6px 11px #000;
    border: 1px solid #333;
}
.skill .tool-tip .current-rank-description {
    color: #fc3;
}
.skill .tool-tip .next-rank-description {
    -moz-opacity: 0.35;
    -khtml-opacity: 0.35;
    -webkit-opacity: 0.35;
    opacity: 0.35;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=35);
    filter: alpha(opacity=35);
    color: #fc3;
}
.skill .tool-tip .talent-summary {
    color: #fc3;
}
.skill .tool-tip .help-message {
    color: #c00;
}
.skill .tool-tip .help-message.positive {
    color: #390;
}
.skill .skill-dependency {
    position: absolute;
    display: block;
    bottom: 73px;
    left: 50%;
    -moz-opacity: 0.35;
    /**************************************************
	DEPENDENCY ARROWS
**************************************************/
    
    -khtml-opacity: 0.35;
    -webkit-opacity: 0.35;
    opacity: 0.35;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=35);
    filter: alpha(opacity=35);
    pointer-events: none;
    background: url(img/connection-sprite.png) no-repeat top left;
    -webkit-transition: all 0.3s ease-out;
    -moz-transition: all 0.3s ease-out;
    -o-transition: all 0.3s ease-out;
    transition: all 0.3s ease-out;
}
[data-skill-id="2"] .skill-dependency {
    margin-left: -15px;
    width: 350px;
    height: 60px;
    background-position: -285px -10px;
}
[data-skill-id="3"] .skill-dependency,
[data-skill-id="5"] .skill-dependency,
[data-skill-id="20"] .skill-dependency,
[data-skill-id="23"] .skill-dependency {
    margin-left: 15px;
    width: 60px;
    height: 40px;
    background-position: -740px -10px;
    margin-bottom: -50px;
}
[data-skill-id="4"] .skill-dependency {
    margin-left: -20px;
    width: 40px;
    height: 190px;
    background-position: 0 -10px;
}
[data-skill-id="7"] .skill-dependency,
[data-skill-id="9"] .skill-dependency,
[data-skill-id="10"] .skill-dependency,
[data-skill-id="12"] .skill-dependency,
[data-skill-id="14"] .skill-dependency,
[data-skill-id="25"] .skill-dependency {
    margin-left: -20px;
    width: 40px;
    height: 70px;
    background-position: 0 -210px;
}
[data-skill-id="15"] .skill-dependency,
[data-skill-id="22"] .skill-dependency {
    margin-left: -60px;
    width: 120px;
    height: 80px;
    background-position: -160px 10px;
}
[data-skill-id="16"] .skill-dependency {
    margin-left: -85px;
    width: 60px;
    height: 40px;
    background-position: -640px -10px;
    margin-bottom: -50px;
}
[data-skill-id="17"] .skill-dependency {
    margin-left: -85px;
    width: 150px;
    height: 40px;
    background-position: -640px -10px;
    margin-bottom: -50px;
}
[data-skill-id="19"] .skill-dependency {
    margin-left: -20px;
    width: 120px;
    height: 80px;
    background-position: -40px 10px;
}
[data-skill-id="26"] .skill-dependency {
    margin-left: -310px;
    width: 720px;
    height: 200px;
    background-position: -60px -90px;
}
[data-skill-id="10"] .tool-tip,
[data-skill-id="11"] .tool-tip,
[data-skill-id="12"] .tool-tip,
[data-skill-id="13"] .tool-tip,
[data-skill-id="14"] .tool-tip,
[data-skill-id="15"] .tool-tip,
[data-skill-id="16"] .tool-tip,
[data-skill-id="10"] .tool-tip,
[data-skill-id="17"] .tool-tip,
[data-skill-id="24"] .tool-tip,
[data-skill-id="25"] .tool-tip {
    left: -320px;
}
.skill[data-skill-id="1"] {
    left: 440px;
    top: 10px;
}
.skill[data-skill-id="1"] .icon {
    background-position: -240px 0px;
}
.skill[data-skill-id="2"] {
    left: 320px;
    top: 135px;
}
.skill[data-skill-id="2"] .icon {
    background-position: -240px -60px;
}
.skill[data-skill-id="3"] {
    left: 220px;
    top: 135px;
}
.skill[data-skill-id="3"] .icon {
    background-position: -420px 0px;
}
.skill[data-skill-id="4"] {
    left: 320px;
    top: 385px;
}
.skill[data-skill-id="4"] .icon {
    background-position: -120px -120px;
}
.skill[data-skill-id="5"] {
    left: 220px;
    top: 385px;
}
.skill[data-skill-id="5"] .icon {
    background-position: 0px -120px;
}
.skill[data-skill-id="6"] {
    left: 400px;
    top: 135px;
}
.skill[data-skill-id="6"] .icon {
    background-position: -360px 0px;
}
.skill[data-skill-id="7"] {
    left: 400px;
    top: 260px;
}
.skill[data-skill-id="7"] .icon {
    background-position: 0px 0px;
}
.skill[data-skill-id="8"] {
    left: 480px;
    top: 135px;
}
.skill[data-skill-id="8"] .icon {
    background-position: -240px -120px;
}
.skill[data-skill-id="9"] {
    left: 480px;
    top: 260px;
}
.skill[data-skill-id="9"] .icon {
    background-position: -300px 0px;
}
.skill[data-skill-id="10"] {
    left: 480px;
    top: 385px;
}
.skill[data-skill-id="10"] .icon {
    background-position: -120px -180px;
}
.skill[data-skill-id="11"] {
    left: 640px;
    top: 135px;
}
.skill[data-skill-id="11"] .icon {
    background-position: -60px -240px;
}
.skill[data-skill-id="12"] {
    left: 640px;
    top: 260px;
}
.skill[data-skill-id="12"] .icon {
    background-position: -60px -300px;
}
.skill[data-skill-id="13"] {
    left: 720px;
    top: 135px;
}
.skill[data-skill-id="13"] .icon {
    background-position: -300px -120px;
}
.skill[data-skill-id="14"] {
    left: 720px;
    top: 260px;
}
.skill[data-skill-id="14"] .icon {
    background-position: -300px -180px;
}
.skill[data-skill-id="15"] {
    left: 680px;
    top: 385px;
}
.skill[data-skill-id="15"] .icon {
    background-position: -120px -60px;
}
.skill[data-skill-id="16"] {
    left: 780px;
    top: 385px;
}
.skill[data-skill-id="16"] .icon {
    background-position: -180px -120px;
}
.skill[data-skill-id="17"] {
    left: 580px;
    top: 385px;
}
.skill[data-skill-id="17"] .icon {
    background-position: -300px -60px;
}
.skill[data-skill-id="18"] {
    left: 140px;
    top: 135px;
}
.skill[data-skill-id="18"] .icon {
    background-position: -360px -300px;
}
.skill[data-skill-id="19"] {
    left: 100px;
    top: 260px;
}
.skill[data-skill-id="19"] .icon {
    background-position: -240px -180px;
}
.skill[data-skill-id="20"] {
    left: 0px;
    top: 260px;
}
.skill[data-skill-id="20"] .icon {
    background-position: -360px -60px;
}
.skill[data-skill-id="21"] {
    left: 180px;
    top: 260px;
}
.skill[data-skill-id="21"] .icon {
    background-position: -360px -120px;
}
.skill[data-skill-id="22"] {
    left: 140px;
    top: 385px;
}
.skill[data-skill-id="22"] .icon {
    background-position: -120px -240px;
}
.skill[data-skill-id="23"] {
    left: 40px;
    top: 385px;
}
.skill[data-skill-id="23"] .icon {
    background-position: -480px 0px;
}
.skill[data-skill-id="24"] {
    left: 840px;
    top: 135px;
}
.skill[data-skill-id="24"] .icon {
    background-position: -420px -180px;
}
.skill[data-skill-id="25"] {
    left: 840px;
    top: 260px;
}
.skill[data-skill-id="25"] .icon {
    background-position: -360px -180px;
}
.skill[data-skill-id="26"] {
    left: 440px;
    top: 520px;
}
.skill[data-skill-id="26"] .icon {
    background-position: -120px 0px;
}
.avatar {
    position: absolute;
    width: 380px;
    top: 525px;
    left: 50%;
    margin-left: -425px;
    -webkit-transform: scale(0);
    -moz-transform: scale(0);
    -o-transform: scale(0);
    -ms-transform: scale(0);
    transform: scale(0);
    -moz-opacity: 0;
    -khtml-opacity: 0;
    -webkit-opacity: 0;
    opacity: 0;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=0);
    filter: alpha(opacity=0);
}
.page .avatar {
    -webkit-transition: all 0.3s ease-out;
    -moz-transition: all 0.3s ease-out;
    -o-transition: all 0.3s ease-out;
    transition: all 0.3s ease-out;
}
.page .avatar {
    -webkit-transform: scale(1);
    -moz-transform: scale(1);
    -o-transform: scale(1);
    -ms-transform: scale(1);
    transform: scale(1);
    -moz-opacity: 1;
    -khtml-opacity: 1;
    -webkit-opacity: 1;
    opacity: 1;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=100);
    filter: alpha(opacity=100);
}
.avatar .portrait {
    background: url(img/avatar-frame.png) top left no-repeat;
    position: absolute;
    top: 15px;
    width: 140px;
    height: 140px;
    pointer-events: none;
}
.avatar .portrait img {
    -webkit-border-radius: 5px;
    -moz-border-radius: 5px;
    border-radius: 5px;
    overflow: hidden;
    margin: 10px 16px 16px 16px;
    width: 108px;
    height: 108px;
}
.avatar .portrait-controls {
    position: absolute;
    top: 135px;
    width: 140px;
    text-align: center;
    -moz-opacity: 0.35;
    -khtml-opacity: 0.35;
    -webkit-opacity: 0.35;
    opacity: 0.35;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=35);
    filter: alpha(opacity=35);
    -webkit-transition: all 0.3s ease-out;
    -moz-transition: all 0.3s ease-out;
    -o-transition: all 0.3s ease-out;
    transition: all 0.3s ease-out;
}
.avatar .portrait-controls button {
    padding: 0 12px 3px;
    -webkit-border-top-right-radius: 0;
    -webkit-border-bottom-right-radius: 5px;
    -webkit-border-bottom-left-radius: 5px;
    -webkit-border-top-left-radius: 0;
    -moz-border-radius-topright: 0;
    -moz-border-radius-bottomright: 5px;
    -moz-border-radius-bottomleft: 5px;
    -moz-border-radius-topleft: 0;
    border-top-right-radius: 0;
    border-bottom-right-radius: 5px;
    border-bottom-left-radius: 5px;
    border-top-left-radius: 0;
    -moz-background-clip: padding-box;
    -webkit-background-clip: padding-box;
    background-clip: padding-box;
    margin: 3px 1px;
}
.avatar:hover .portrait-controls {
    -moz-opacity: 1;
    -khtml-opacity: 1;
    -webkit-opacity: 1;
    opacity: 1;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=100);
    filter: alpha(opacity=100);
}
.avatar:hover input.h2 {
    border: 1px solid #444;
    outline-width: 0;
    background: #111;
}
.avatar .details {
    padding: 20px 20px 20px 30px;
    margin-left: 120px;
    border: 1px solid #fc6;
    -webkit-border-radius: 3px;
    -moz-border-radius: 3px;
    border-radius: 3px;
    background: black;
    -webkit-box-shadow: 0 6px 11px #000;
    -moz-box-shadow: 0 6px 11px #000;
    box-shadow: 0 6px 11px #000;
    min-height: 115px;
}
.avatar .details .talent-summary {
    color: #fc3;
}
.sign-off {
    position: absolute;
    width: 310px;
    top: 525px;
    left: 50%;
    margin-left: 105px;
    -webkit-transform: scale(0);
    -moz-transform: scale(0);
    -o-transform: scale(0);
    -ms-transform: scale(0);
    transform: scale(0);
    -moz-opacity: 0;
    -khtml-opacity: 0;
    -webkit-opacity: 0;
    opacity: 0;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=0);
    filter: alpha(opacity=0);
    padding-bottom: 100px;
}
.page .sign-off {
    -webkit-transition: all 0.3s ease-out;
    -moz-transition: all 0.3s ease-out;
    -o-transition: all 0.3s ease-out;
    transition: all 0.3s ease-out;
}
.page .sign-off {
    -webkit-transform: scale(1);
    -moz-transform: scale(1);
    -o-transform: scale(1);
    -ms-transform: scale(1);
    transform: scale(1);
    -moz-opacity: 1;
    -khtml-opacity: 1;
    -webkit-opacity: 1;
    opacity: 1;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=100);
    filter: alpha(opacity=100);
}
.sign-off .logo-352 {
    display: block;
    float: left;
}
.sign-off ul {
    margin-bottom: 20px;
}
.start-helper {
    background: url(img/red-arrow.png) no-repeat left center;
    padding-left: 55px;
    position: absolute;
    top: 30px;
    left: 530px;
    -moz-opacity: 0;
    -khtml-opacity: 0;
    -webkit-opacity: 0;
    opacity: 0;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=0);
    filter: alpha(opacity=0);
}
.start-helper.active {
    -moz-opacity: 1;
    -khtml-opacity: 1;
    -webkit-opacity: 1;
    opacity: 1;
    -ms-filter: progid: DXImageTransform.Microsoft.Alpha(opacity=100);
    filter: alpha(opacity=100);
}
</style>
</head>
<body>
<div class="ltIE9-hide">
    <header>滑板技能树</header>
    <div class="page">
        <div class="talent-tree">
            <h2 class="start-helper" data-bind="css:{active:noPointsSpent}">开始吧!</h2>
            <!--ko foreach: skills-->
            <!--ko if: hasDependencies-->
            <div data-bind="css: { 'can-add-points': canAddPoints, 'has-points': hasPoints, 'has-max-points': hasMaxPoints }, attr: { 'data-skill-id': id }" class="skill">
                <div data-bind="css: { active: dependenciesFulfilled }" class="skill-dependency"></div>
            </div>
            <!--/ko-->
            <!--/ko-->
            <!--ko foreach: skills-->
            <div data-bind="css: { 'can-add-points': canAddPoints, 'has-points': hasPoints, 'has-max-points': hasMaxPoints }, attr: { 'data-skill-id': id }" class="skill">
                <div class="icon-container">
                    <div class="icon"></div>
                </div>
                <div class="frame">
                    <div class="tool-tip">
                        <h3 data-bind="text: title" class="skill-name"></h3>
                        <div data-bind="html: description" class="skill-description"></div>
                        <ul class="skill-links">
                            <!--ko foreach: links-->
                            <li>
                                <a data-bind="attr: { href: url }, click: function(){ 
                                        return true;
                                        }, text: label" target="_blank"></a>
                            </li>
                            <!--/ko-->
                        </ul>
                        <hr data-bind="visible: currentRankDescription() || nextRankDescription()">
                        <div data-bind="if: currentRankDescription" class="current-rank-description">当前级别: <span data-bind="    text: currentRankDescription"></span>
                        </div>
                        <div data-bind="if: nextRankDescription" class="next-rank-description">下一级别: <span data-bind=" text: nextRankDescription"></span>
                        </div>
                        <hr>
                        <ul class="stats">
                            <!--ko foreach: stats-->
                            <li><span class="value">+<span data-bind="text: value"></span></span> <span data-bind=" text: title" class="title"></span>
                            </li>
                            <!--/ko-->
                        </ul>
                        <!--ko if: talentSummary-->
                        <div class="talent-summary">Grants <span data-bind="text: talentSummary"></span>
                        </div>
                        <!--/ko-->
                        <div data-bind="text: helpMessage, css:{positive: dependenciesFulfilled}" class="help-message"></div>
                    </div>
                    <div class="skill-points"><span data-bind="text: points" class="points"></span>/<span data-bind="   text: maxPoints" class="max-points"></span>
                    </div>
                    <div data-bind="click: addPoint, rightClick: removePoint" class="hit-area"></div>
                </div>
            </div>
            <!--/ko-->
        </div>
        <div class="avatar">
            <div class="portrait">
                <img data-bind="attr: { src: portraitURL }">
            </div>
            <div class="portrait-controls">
                <button data-bind="click: choosePreviousPortrait">&laquo;</button>
                <button data-bind="click: chooseNextPortrait">&raquo;</button>
            </div>
            <div class="details">
                <input data-bind="value: avatarName" class="h2">
                <div class="level">Level <span data-bind="  text: level" class="value"></span> 滑手</div>
                <div data-bind="text: talentSummary" class="talent-summary"></div>
                <ul class="stats">
                    <!--ko foreach: stats-->
                    <li><span data-bind="text: title" class="title"></span>: <span data-bind="  text: value" class="value"></span>
                    </li>
                    <!--/ko-->
                </ul>
            </div>
        </div>
        <div class="sign-off">
            <h2>来看看我：</h2>
            <ul>
                <li><a href="https://space.bilibili.com/291947905" target="_blank">BILIBILI</a>
                </li>
                <li><a href="https://www.zhihu.com/people/cheng-zi-hong-97" target="_blank">知乎</a>
                </li>
                <li><a href="https://chenzihong-gavin.github.io/" target="_blank">个人博客</a>
                </li>
                <li><a href="https://github.com/ChenZiHong-Gavin" target="_blank">GITHUB</a>
            </ul>
            <h2>给我投喂</h2>
            <a href="https://github.com/ChenZiHong-Gavin">
                <img src="img/pay.png" alt="payment">
            </a>
        </div>
    </div>
</div>

<script src="js/jquery.min.js"></script>
<script src="js/knockout.min.js"></script>
<script src="js/utils.js"></script>
<script>
//data part
(function() {
    (function(ns) {
        ns.data = {
            skills: [{
                    id: 1,
                    title: '买一块滑板',
                    description: '当你拥有了一块滑板，一切从这里开始了',
                    rankDescriptions: [
                        '你知道如何分辨专业板和玩具板', '你了解滑板是由哪几个部分组成的','你知道如何搭配一块适合自己的滑板'
                    ],
                    links: [{
                        label: '【滑板视频】up主用的什么滑板？新手买什么滑板好？？？',
                        url: 'https://www.bilibili.com/video/BV1eE41187i6?from=search&seid=15296292863869150823'
                    }, {
                        label: '某滑手耗时8小时只为拍摄滑板组装定格动画',
                        url: 'https://www.bilibili.com/video/BV1q4411B7GM?from=search&seid=5483120130861820055'
                    },
                    {
                        label: '滑板教学 | 新手必看 七个平价进口板面品牌推荐',
                        url: 'https://www.bilibili.com/video/BV1V4411r7EA'
                    }
                ],
                    maxPoints: 3,
                    stats: [{
                        title: '智力',
                        value: 1
                    }, {
                        title: '魅力',
                        value: 1
                    }, {
                        title: '力量',
                        value: 1
                    }],
                    talents: ['有老婆的人']
                },

                {
                    id: 2,
                    title: '滑行和转弯',
                    description: '踩上滑板，感受风的温度',
                    dependsOn: [1],
                    links: [{
                        label: '【滑板教学】新手应该怎么学习滑行？？？',
                        url: 'https://www.bilibili.com/video/BV1qT4y1F7xd?from=search&seid=15007634551498557142'
                    }, {
                        label: '【教程】滑板第一课-站姿、滑行、转弯、刹车 HOW TO SKATEBOARD FOR BEGINNERS',
                        url: 'https://www.bilibili.com/video/BV1sW411J7vP?from=search&seid=15007634551498557142'
                    }],
                    maxPoints: 2,
                    stats: [{
                        title: '魅力',
                        value: 3
                    }],
                    rankDescriptions: [
                        '你可以后脚蹬地获得滑行的速度', '你知道怎样调整重心使滑板转向'
                    ],
                    talents: ['崭新的滑手']
                }, 
                
                {
                    id: 3,
                    title: '收板',
                    dependsOn: [2],
                    links: [{
                        label: '【滑板教学】会滑行就可以学，最实用的滑行收板动作教学~~~',
                        url: 'https://www.bilibili.com/video/BV1X5411s7Xv'

                    },
                        {
                        label: '八种酷酷的收板方式',
                        url: 'https://www.bilibili.com/video/BV1es411w74Q'
                    }],
                    maxPoints: 1,
                    rankDescriptions: [
                        '你可以不像一个菜鸟滑手：停下、弯腰、拿起板子'
                    ],
                    description: '走路与滑行来回切换',
                    stats: [{
                        title: '魅力',
                        value: 2
                    }, {
                        title: '敏捷度',
                        value: 1
                    }]
                }, 
                
                {
                    id: 4,
                    title: 'MANUAL',
                    dependsOn: [2],
                    description: '非常非常基础的招式，十分锻炼平衡能力',
                    links: [{
                        label: '滑板新手最基础动作:蛮牛manual教学',
                        url: 'https://www.bilibili.com/video/BV16K4y1e7BR'

                    },
                    {
                        label: '[滑板教学] Aaron Kyro | 怎样高效练习Manual #双字#',
                        url: 'https://www.bilibili.com/video/BV1RW411B7Cy'
                    }
                ],
                    maxPoints: 2,
                    rankDescriptions: [
                        '你可以很轻松地调整板子的平衡','你可以将MANUAL与其它滑板招式组合'
                    ],
                    stats: [{
                        title: '魅力',
                        value: 10
                    }]
                }, 
                
                {
                    id: 5,
                    title: 'KICK TURN',
                    dependsOn: [4],
                    links: [{
                        label: '【Silent滑板】新手滑板教学 踢转',
                        url: 'https://www.bilibili.com/video/BV1DV411k73t'
                    }],
                    maxPoints: 1,
                    description: '一个非常简单但是炫酷的转向小技巧，使你日常的滑行变得更加自然',
                    talents: ['Sizzlin'],
                    stats: [{
                        title: '魅力',
                        value: 2
                    }, {
                        title: '敏捷度',
                        value: 1
                    }]
                },

                {
                    id: 6,
                    title: '刹车',
                    dependsOn: [1],
                    links: [{
                        label: '基础滑板刹车教学-滑行刹车（转载）',
                        url: 'https://www.bilibili.com/video/BV1at411E7Gy?from=search&seid=14569201153341425880'
                    }, {
                        label: '【1985滑板教学】滑行与刹车 | 新手入门基础教学',
                        url: 'https://www.bilibili.com/video/BV1Tt411d7ta'
                    }, {
                        label: '【滑板教学】新手必看，简单实用的滑行刹车动作，会滑行就可以学学看~~~',
                        url: 'https://www.bilibili.com/video/BV1CK41177qQ'
                    }],
                    description: '知道怎么动起来，知道怎么停下来，理论上你可以滑板去任何地方不被车撞',
                    stats: [{
                        title: '智力',
                        value: 2
                    }, {
                        title: '知识',
                        value: 1
                    }]
                }, {
                    id: 7,
                    title: 'powerslide 横刹',
                    dependsOn: [6],
                    links: [{
                        label: '日本小哥横刹(PowerSlide)教学【搬运|字幕】',
                        url: 'https://www.bilibili.com/video/BV1wy4y1E7KL'
                    }, {
                        label: '【滑板教学】详细横刹教学，比Ollie还简单的基础招式！新手基础教学必看！',
                        url: 'https://www.bilibili.com/video/BV1W7411v7hA'
                    }],
                    description: '诸多刹车技巧中，横刹是最经济也是最帅的一种，当然首先你得腰好',
                    rankDescription: ['你可以判断哪些地面适合横刹，哪些不适合','你的横刹有了自己帅气的风格','你可以在高速下坡的时候进行横刹'],
                    maxPoints: 3,
                    stats: [{
                        title: '智力',
                        value: 1
                    }, {
                        title: '知识',
                        value: 2
                    }],
                    talents: ['Crafty']
                },

                {
                    id: 8,
                    title: '荡板',
                    dependsOn: [1],
                    links: [{
                        label: '【荡板】滑板荡板教学，学完滑行之后要学习的动作，对你以后的滑板练习会有很大帮助！',
                        url: 'https://www.bilibili.com/video/BV1K54y1979F'
                    }, {
                        label: '滑板教学荡板加速的终极秘密｜Tic tac不再倒退走！',
                        url: 'https://www.bilibili.com/video/BV1Xr4y1N7YS'
                    }, {
                        label: '【滑板教学】Ollie前你需要GET的滑板技巧 中文字幕合集',
                        url: 'https://www.bilibili.com/video/BV1uJ411V7kE'
                    }],
                    description: '基础中的基础，基本上每一个滑手都会告诉你，新手要练好荡板',
                    maxPoints: 3,
                    stats: [{
                        title: '敏捷度',
                        value: 3
                    }]
                },
                
                {
                    id: 9,
                    title: '倒滑180',
                    dependsOn: [8],
                    maxPoints: 2,
                    description: '一个非常简单的滑板技巧，但是让你掌握了最基本的转身动作',
                    links:[
                        {
                            label: '滑板基础篇：fakie pivot',
                            url: 'https://www.bilibili.com/video/BV1h741127Ww'
                        }
                    ],
                    stats: [{
                        title: '敏捷度',
                        value: 2
                    }, {
                        title: '知识',
                        value: 1
                    }],
                    talents: ['Nimble']
                }, 
                
                {
                    id: 10,
                    title: 'NORMAL SWITCH FAKIE NOLLIE',
                    description: '滑板的四种脚位，排列组合一下，滑板的招式一下子丰富了起来',
                    links:[
                        {
                            label: '【教程】Normal常位；Fakie倒滑；Switch反脚 和Nollie反脚倒滑——滑板脚位',
                            url: 'https://www.bilibili.com/video/BV1WW411u73S'
                        }
                    ],
                    rankDescription: ['每种脚位都像是你的惯用脚位','当你学会一个新招的时候，就相当于你学会了四个招'],
                    maxPoints: 2,
                    dependsOn: [9],
                    stats: [{
                        title: '敏捷度',
                        value: 10
                    }]
                },

                {
                    id: 11,
                    title: 'OLLIE',
                    dependsOn: [1],
                    links: [{
                        label: '滑板ollie豚跳的基础教学视频，很详细！推荐',
                        url: 'https://www.bilibili.com/video/BV1tx41197N5'
                    },
                    {
                        label: '【自制字幕】滑板教程 Ollie详细诀窍：让你完美掌握Ollie，治疗常见疑难杂症',
                        url: 'https://www.bilibili.com/video/BV1Zx41127ez'
                    },
                    {
                        label: '【搬运 | 自制中字】Ollie 点板、刷板、推板教程 how to Ollie the easiest way｜Aaron Kyro',
                        url: 'https://www.bilibili.com/video/BV1J441127Gw'
                    },
                    {
                        label: '【滑板教学】Ollie后你需要掌握的平地滑板动作 合集',
                        url: 'https://www.bilibili.com/video/BV1jJ411n74f'
                    }
                ],
                    description: '滑板动作的重中之重，你学不会OLLIE，就永远也不会滑板。无数人倒在了这一步',
                    rankDescription: ['你可以原地OLLIE，找到点板与刷板的感觉','你可以滑行时使用OLLIE过立，跳过大大小小各种障碍'],
                    maxPoints: 2,
                    stats: [{
                        title: '力量',
                        value: 3
                    }]
                }, 
                
                {
                    id: 12,
                    title: 'FS/BS OLLIE',
                    dependsOn: [11],
                    links: [{
                        label: '修一下基础动作 PJJ教你做 内转/外转',
                        url: 'https://www.bilibili.com/video/BV1g74115772'
                    }, {
                        label: '#中文字幕# Frontside 360 滑板教学（外转360）',
                        url: 'https://www.bilibili.com/video/BV1554y1X7GQ/'
                    }, {
                        label: '#中文字幕#Backside 360滑板教学（内转360）',
                        url: 'https://www.bilibili.com/video/BV1Sg4y1q79o'
                    }],
                    description: '熟练OLLIE之后，可以直接练习的招，第一次在空中转身',
                    rankDescription: ['转180°','转360°'],
                    maxPoints: 2,
                    stats: [{
                        title: '力量',
                        value: 2
                    }, {
                        title: '知识',
                        value: 1
                    }],
                    talents: ['Beefcake']
                },

                {
                    id: 13,
                    title: 'SHOVE IT'
                        //, dependsOn: [1]
                        ,
                    links: [{
                        label: '【滑板教学】教你如何做出Shove it 详细教学 新手必看 看了包会',
                        url: 'https://www.bilibili.com/video/BV1at411K7W1'
                    }, {
                        label: '【滑板教学】如何做好一个Shove it？（中文字幕）',
                        url: 'https://www.bilibili.com/video/BV1tb411x7Uo'
                    }, {
                        label: '最简单的滑板招？5分钟拿下shuvit/shove it！',
                        url: 'https://www.bilibili.com/video/BV1LQ4y1N7Ga'
                    }],
                    maxPoints: 1,
                    description: '没有OLLIE基础也能练习的一个小招，练成之后你的控板能力会大大增加',
                    stats: [{
                        title: '力量',
                        value: 3
                    }]
                }, 
                
                {
                    id: 14,
                    title: 'POP SHOVE IT',
                    dependsOn: [13],
                    links: [{
                        label: '【搬运】美式pop shove it教学',
                        url: 'https://www.bilibili.com/video/BV1Sg4y1B7sz'
                    }, {
                        label: '[滑板教学] Aaron Kyro | 怎样高效练习Pop Shove It #双字#',
                        url: 'https://www.bilibili.com/video/BV1dx411L74v'
                    }],
                    maxPoints: 1,
                    description: '有人觉得挺难，有人觉得有脚就行，这招远比你想象的帅气',
                    stats: [{
                        title: '力量',
                        value: 2
                    }, {
                        title: '敏捷度',
                        value: 1
                    }],
                    talents: ['XXL Knapsack']
                },

                {
                    id: 15,
                    title: 'KICKFLIP/HEELFLIP',
                    dependsOn: [12, 14],
                    description: '你的滑板在你的脚下翻了一圈并被稳稳地接住，Rodney Mullen发明这一招的时候被别人认为是不可思议的',
                    links: [{
                        label: '【滑板教学】如何做好一个尖翻？（中文字幕）',
                        url: 'https://www.bilibili.com/video/BV1M4411S7U1'
                    }],
                    stats: [{
                        title: '力量',
                        value: 10
                    }]
                }, 
                
                {
                    id: 16,
                    title: 'BIG SPIN',
                    dependsOn: [15],
                    links: [{
                        label: '【滑板教学】滑板大乱教学',
                        url: 'https://www.bilibili.com/video/BV1mb411M7gA'
                    }],
                    description: '每一个滑板都幻想可以有一天随地大乱',
                    stats: [{
                        title: '韧性',
                        value: 5
                    }],
                    talents: ['Truthseeker']
                }, 
                


                {
                    id: 18,
                    title: '十分熟练的滑行',
                    maxPoints: 2,
                    links: [{
                        label: 'Instreet滑板 看完会让你爱上滑板！知名滑板影片导演Juan Rayos超唯美短片',
                        url: 'https://www.bilibili.com/video/BV1Hs411d73h'
                    },
                    {
                        label: '或许这才是真正的刷街吧',
                        url: 'https://www.bilibili.com/video/BV1HW411e7wB'
                    }
                ],
                    description: '你滑板去上课、去吃饭、去买东西，任何可以用滑板到达的地方都将使用滑板',
                    stats: [{
                        title: '知识',
                        value: 2
                    }, {
                        title: '魅力',
                        value: 1
                    }],
                    talents: ['Mindreader']
                },
                
                {
                    id: 19,
                    title: '一些风格小招',
                    maxPoints: 2,
                    rankDescriptions: [
                        '你拥有自己的滑板风格', '你可以创造一些奇妙的招式'
                    ],
                    dependsOn: [18],
                    links: [{
                        label: '5招新手向动作',
                        url: 'https://www.bilibili.com/video/BV1rW411j7tx'
                    }, {
                        label: '滑板新手教学-5个你一天就能学会的动作',
                        url: 'https://www.bilibili.com/video/BV144411E7gS'
                    }, {
                        label: '10个风格小招【滑板教学】',
                        url: 'https://www.bilibili.com/video/BV1uW411R794'
                    }, {
                        label: '【搬运 | 英字机翻】十五个简单的滑板技巧｜Aaron Kyro',
                        url: 'https://www.bilibili.com/video/BV17441127dB'
                    },
                    {
                        label: '滑板初学者教学】10个不需要ollie技巧就能完成的“酷炫”动作',
                        url: 'https://www.bilibili.com/video/BV1uW41187ib'
                    },
                    {
                        label: '滑板教学 | 新手必学！不需要Ollie基础的十个无门槛滑板动作 独家字幕',
                        url: 'https://www.bilibili.com/video/BV1K4411i7Wy'
                    },
                    {
                        label: '简单有趣的滑板招式',
                        url: 'https://www.bilibili.com/video/BV1Xt41157fv'
                    }
                ],
                    description: '当你搓招到绝望的时候，不妨试试这些简单易学的有趣招式，重拾对滑板的兴趣',
                    stats: [{
                        title: '魅力',
                        value: 3
                    }],
                    talents: ['Artistic']
                },
                
                {
                    id: 20,
                    title: '自由式滑板',
                    dependsOn: [19],
                    links: [
                        {
                            label: '【BangTo滑板】2018年度日本自由式滑板(Freestyle skateboard)比赛集锦',
                            url: 'https://www.bilibili.com/video/BV1ut411Q77W'

                        },
                        {
                        label: '【英语+机翻】自由式滑板教程 by：Keith Butterfield',
                        url: 'https://www.bilibili.com/video/BV1mp411d7ft/'
                    },
                    {
                        label: 'Freestyle Trick Tips',
                        url: 'https://www.bilibili.com/video/BV14x411j7h8'
                    },
                    {
                        label: 'Freestyle Trick Tips',
                        url: 'https://www.bilibili.com/video/BV16W411S74u'
                    },
                    {
                        label: '日本滑板教程中字】已更完',
                        url: 'https://www.bilibili.com/video/BV1cs411W7x3'
                    }
                ],
                    description: '自由式滑板是一种古老且小众的玩法，但是看上去自由式滑手们似乎在做许多不可能完成的动作',
                    stats: [{
                        title: '魅力',
                        value: 2
                    }, {
                        title: '智力',
                        value: 1
                    }]
                },
                
                {
                    id: 21,
                    title: '来点儿道具',
                    dependsOn: [18],
                    links: [{
                        label: '【日本道具类滑板教学】杆子 台子类动作',
                        url: 'https://www.bilibili.com/video/BV1rs411E7Ta'
                    }],
                    description: '板场中有各种各样的道具，用来模拟现实中各种各样的地形',
                    stats: [{
                        title: '知识',
                        value: 1
                    }, {
                        title: '智力',
                        value: 2
                    }],
                    talents: ['Conjurer']
                },
                
                {
                    id: 22,
                    title: '各种地形刷街',
                    dependsOn: [19, 21],
                    description: '大胆去刷街吧，注意安全',
                    stats: [{
                        title: '知识',
                        value: 1
                    }, {
                        title: '魅力',
                        value: 2
                    }]
                }, 
                
                {
                    id: 23,
                    title: '进入碗池',
                    dependsOn: [22],
                    links: [{
                        label: '【滑板文化】滑板各种U池碗池弧面特辑',
                        url: 'https://www.bilibili.com/video/BV1ws411n7Nc'
                    }, {
                        label: '【教程】滑板碗池基础 Learn To Skate A Pool',
                        url: 'https://www.bilibili.com/video/BV18p411R7NN'
                    }],
                    description: '在碗池里面有一种冲浪的感觉，毕竟滑板是从冲浪板发展而来的',
                    stats: [{
                        title: '魅力',
                        value: 1
                    }, {
                        title: '知识',
                        value: 2
                    }],
                    talents: ['Alchemist']
                },

                {
                    id: 24,
                    title: 'NO COMPLY',
                    links: [{
                        label: '滑板教学 各种No Comply （bs 360 no comply） 教学合集',
                        url: 'https://www.bilibili.com/video/BV1Ux411U7wK'
                    }, {
                        label: 'Apache mod_rewrite - Apache HTTP Server',
                        url: 'http://httpd.apache.org/docs/2.4/rewrite/'
                    },
                    {
                        label: '【滑板教学】女生喜欢男生爱练的小招-No comply 180与它的姐妹招No comply fs shove it',
                        url: 'https://www.bilibili.com/video/BV12E411f7TJ'
                    },
                    {
                        label: '[滑板教学] Aaron Kyro | 怎样高效练习No Comply 180 #双字#',
                        url: 'https://www.bilibili.com/video/BV1ax411L79V'
                    }
                ],
                    maxPoints: 1,
                    description: '干净利落的NO COMPLY可以让你伪装成一个大神滑手',
                    stats: [{
                        title: '韧性',
                        value: 3
                    }],
                    talents: ['Stewardship']
                },
                
                {
                    id: 25,
                    title: 'VARIAL KICKFLIP',
                    dependsOn: [24],
                    links: [{
                        label: '【分分钟搞定】板仔必会招之小乱，有些人会了大乱都不一定会小乱',
                        url: 'https://www.bilibili.com/video/BV16E411K7jf'
                    }, {
                        label: '【滑板教学】新手必练，超帅女滑手教你做小乱！（varialkickflip）',
                        url: 'https://www.bilibili.com/video/BV1Y4411U7qw'
                    }, {
                        label: '超详细讲解 五分钟了解VARIAL KICKFLIP尖翻小乱的原理',
                        url: 'https://www.bilibili.com/video/BV1bs411F7td'
                    }],
                    maxPoints: 1,
                    description: '啥也没看清呢，板都已经翻过去了',
                    stats: [{
                        title: '韧性',
                        value: 2
                    }, {
                        title: '敏捷度',
                        value: 1
                    }],
                    talents: ['Spectral Guide']
                },

                {
                    id: 26,
                    title: '和朋友们一起玩',
                    dependsOn: [4, 5, 10, 15, 22, 25],
                    links: [{
                        label: '[滑板教学] Aaron Kyro | 滑板基础招式教学合集 #双字#',
                        url: 'https://www.bilibili.com/video/BV1hW411j75L'
                    },
                    {
                        label: '滑板各种招的慢动作，希望对大家有帮助',
                        url: 'https://www.bilibili.com/video/BV1Nx411V7je'
                    },
                    {
                        label: '日本最适合滑板的城市-大阪',
                        url: 'https://www.bilibili.com/video/BV1LQ4y1T7df'
                    }
                ],
                    description: '其实练不练成招、滑得怎么样都无所谓，最重要的是有一群谈得来的朋友，有一段可以虚度的时光',
                    stats: [{
                        title: '魅力',
                        value: 3
                    }, {
                        title: '敏捷度',
                        value: 3
                    }, {
                        title: '韧性',
                        value: 3
                    }, {
                        title: '智力',
                        value: 3
                    }, {
                        title: '力量',
                        value: 3
                    }, {
                        title: '知识',
                        value: 3
                    }],
                    talents: ['Demigod']
                }

            ]
        }
    })(namespace('tft.dnd'));
})();

//logic part
(function($, ko) {

    (function(ns) {
        //VM for the entire Talent Tree page
        var TalentTree = ns.TalentTree = function(_e) {
                var e = _e || {};
                var self = function() {};

                //constants for hash generation
                var asciiOffset = 96; //64 for caps, 96 for lower
                var hashDelimeter = '_';

                var numPortraits = 22;

                //Intro vs Talent Tree UI state
                self.isOpen = ko.observable(true);
                self.open = function() {
                    self.isOpen(true);
                };
                self.close = function() {
                    self.isOpen(false);
                };
                self.toggle = function() {
                    self.isOpen(!self.isOpen());
                };

                //Mega skill list population
                self.skills = ko.observableArray(ko.utils.arrayMap(e.skills, function(item) {
                    return new Skill(item, self.skills);
                }));

                function getSkillById(id) {
                        return ko.utils.arrayFirst(self.skills(), function(item) {
                            return item.id == id;
                        });
                    }
                    //Wire up dependency references
                ko.utils.arrayForEach(e.skills, function(item) {
                    if (item.dependsOn) {
                        var dependent = getSkillById(item.id);
                        ko.utils.arrayForEach(item.dependsOn, function(dependencyId) {
                            var dependency = getSkillById(dependencyId);
                            dependent.dependencies.push(dependency);
                            dependency.dependents.push(dependent);
                        });
                    }
                });

                //Avatar properties
                self.avatarName = ko.observable('Your Name');
                //level = total of all points spent
                self.level = ko.computed(function() {
                    var totalSkillPoints = 0;
                    ko.utils.arrayForEach(self.skills(), function(skill) {
                        totalSkillPoints += skill.points();
                    });
                    return totalSkillPoints + 1;
                });
                self.noPointsSpent = ko.computed(function() {
                    return !Boolean(ko.utils.arrayFirst(self.skills(), function(skill) {
                        return (skill.points() > 0);
                    }));
                });
                self.stats = ko.computed(function() {
                    //set some defaults
                    var totals = {
                        '魅力': 9,
                        '敏捷度': 9,
                        '韧性': 9,
                        '智力': 9,
                        '力量': 9,
                        '知识': 9
                    };
                    //get all the skill name/value pairs and add/create them, using the stat name as the index
                    ko.utils.arrayForEach(self.skills(), function(skill) {
                        var p = skill.points();
                        if (p > 0) ko.utils.arrayForEach(skill.stats, function(stat) {
                            var total = totals[stat.title] || 0;
                            total += stat.value * p; //multiply the stat value by the points spent on the skill
                            totals[stat.title] = total;
                        });
                    });
                    //Translate into a view-friendly array
                    var result = [];
                    for (var statName in totals) {
                        result.push({
                            title: statName,
                            value: totals[statName]
                        });
                    }
                    return result;
                });
                //String of unique characteristics, comma delimeted
                self.talentSummary = ko.computed(function() {
                    var a = [];
                    ko.utils.arrayForEach(self.skills(), function(skill) {
                        if (skill.hasPoints()) a = a.concat(skill.talents)
                    });
                    return a.join(', ');
                });
                //Portrait stuff
                self.portrait = ko.observable(Math.ceil(Math.random() * numPortraits));
                self.portraitURL = ko.computed(function() {
                    return './img/portraits/portrait-' + self.portrait() + '.jpg';
                });
                self.choosePreviousPortrait = function() {
                    var n = self.portrait() - 1;
                    if (n < 1) n = numPortraits;
                    self.portrait(n);
                };
                self.chooseNextPortrait = function() {
                    var n = self.portrait() + 1;
                    if (n > numPortraits) n = 1;
                    self.portrait(n);
                };

                //Utility functions
                self.newbMode = function() {
                    ko.utils.arrayForEach(self.skills(), function(skill) {
                        skill.points(0);
                    });
                };
                self.godMode = function() {
                    ko.utils.arrayForEach(self.skills(), function(skill) {
                        skill.points(skill.maxPoints);
                    });
                };

                //Hash functions
                self.hash = ko.computed(function() {
                    var a = [];
                    //compile a flat list of skill ids and values
                    ko.utils.arrayForEach(self.skills(), function(skill) {
                        if (skill.hasPoints()) {
                            a.push(String.fromCharCode(skill.id + asciiOffset)); //convert skill id to letter of the alphabet
                            if (skill.hasMultiplePoints()) a.push(skill.points()); //only include points if they are > 1
                        }
                    });
                    return ['', a.join(''), self.portrait(), self.avatarName()].join(hashDelimeter);
                });
                //Update the skill tree based on a new hash
                function useHash(hash) {
                    if (hash) {
                        doUpdateHash = false;
                        self.newbMode();

                        var hashParts = hash.split(hashDelimeter);
                        if (hashParts[2]) 
                            self.portrait(Number(hashParts[2])); //use the segment after the second delimeter as the portrait index
                        if (hashParts[3]) 
                        {
                            self.avatarName(decodeURI(hashParts[3]));

                        }
                         //use the segment after the third delimeter as the avatar name

                        var s = hashParts[1]; //use the segment after the first delimeter as the skill hash

                        var pairs = [];

                        //break the hash back down into skill/value pairs, one character at a time
                        var hashCharacters = s.split('');
                        for (var i = 0; i < hashCharacters.length; i++) {
                            if (!Number(hashCharacters[i])) { //if the current character is not a number,
                                var skill = getSkillById(hashCharacters[i].charCodeAt(0) - asciiOffset) //convert the character to a skill id and look it up
                                if (skill) {
                                    var points = Number(hashCharacters[i + 1]) || 1; //default to 1 point if the number is not specified next
                                    pairs.push({
                                        skill: skill,
                                        points: points
                                    })
                                }
                            }
                        }

                        //cycle through the whole list, adding points where possible, until the list is depleted
                        var pointsWereAllocated = true; //flag
                        while (pointsWereAllocated) {
                            pointsWereAllocated = false; //assume the list is depleted by default
                            ko.utils.arrayForEach(pairs, function(pair) {
                                if (!pair.wasAllocated && pair.skill.canAddPoints()) { //only add points once, and only where possible
                                    pair.skill.points(Math.min(pair.skill.maxPoints, pair.points)); //don't add more points than allowed
                                    pair.wasAllocated = true; //don't add this one again
                                    pointsWereAllocated = true;
                                }
                            });
                        }

                        doUpdateHash = true;
                    }
                };

                //Hash thottling

                //update the address bar when the hash changes
                function useLastHash() {
                    useHash(lastHash);
                }

                function updateHash(s) {
                    console.log('updateHash');
                    window.location.hash = s || newHash;
                }
                var lastHash, useHash_timeout, newHash, updateHash_timeout, doUpdateHash = true;
                self.useHash = function(hash) {
                    lastHash = hash;
                    clearTimeout(useHash_timeout);
                    useHash_timeout = setTimeout(useLastHash, 50);
                }
                self.hash.subscribe(function(newValue) {
                    console.log(doUpdateHash);
                    if (doUpdateHash) {
                        newHash = newValue;
                        clearTimeout(updateHash_timeout);
                        updateHash_timeout = setTimeout(updateHash, 50);
                    }
                });

                window.onhashchange = function() {
                    self.useHash(window.location.hash.substr(1));
                };

                //Launch
                var currentHash = window.location.hash.substr(1);
                self.isOpen(currentHash != ''); //If there is a hash, open the skill tree by default
                self.useHash(currentHash);

                return self;
            }
            //VM for individual skills
        var Skill = ns.Skill = function(_e, allSkills) {
                var e = _e || {};
                var self = function() {};

                //Basic properties
                self.id = e.id || 0;
                self.title = e.title || 'Unknown Skill';
                self.description = e.description;
                self.maxPoints = e.maxPoints || 1;
                self.points = ko.observable(e.points || 0);
                self.links = ko.utils.arrayMap(e.links, function(item) {
                    return new Link(item);
                });
                self.dependencies = ko.observableArray([]);
                self.dependents = ko.observableArray([]);
                self.stats = e.stats || [];
                self.rankDescriptions = e.rankDescriptions || [];
                self.talents = e.talents || [];

                //Computed values
                self.hasDependencies = ko.computed(function() {
                    return self.dependencies().length > 0;
                });
                self.dependenciesFulfilled = ko.computed(function() {
                    var result = true;
                    ko.utils.arrayForEach(self.dependencies(), function(item) {
                        if (!item.hasPoints()) result = false;
                    });
                    return result;
                });
                self.dependentsUsed = ko.computed(function() {
                    var result = false;
                    ko.utils.arrayForEach(self.dependents(), function(item) {
                        if (item.hasPoints()) result = true;
                    });
                    return result;
                });
                self.hasPoints = ko.computed(function() {
                    return self.points() > 0;
                });
                self.hasMultiplePoints = ko.computed(function() {
                    return self.points() > 1;
                });
                self.hasMaxPoints = ko.computed(function() {
                    return self.points() >= self.maxPoints;
                });
                self.canAddPoints = ko.computed(function() {
                    return self.dependenciesFulfilled() && !self.hasMaxPoints();
                });
                self.canRemovePoints = ko.computed(function() {
                    //Only allow points to be removed if:
                    //	(A) There are dependents being used but more than one point spent here OR
                    //	(B) There are NO dependents being used and any number of points spent here
                    return (self.dependentsUsed() && self.hasMultiplePoints()) || (!self.dependentsUsed() && self.hasPoints());
                });
                //Summarize what the user needs to unlock this skill (if anything)
                self.helpMessage = ko.computed(function() {
                    if (!self.dependenciesFulfilled()) {
                        var s = [];
                        ko.utils.arrayForEach(self.dependencies(), function(item) {
                            if (!item.hasMaxPoints()) s.push(item.title);
                        });
                        return '学习 ' + prettyJoin(s) + ' 来解锁。'
                    } else if (self.canAddPoints()) {
                        return '点击添加技能点！';
                    }
                    return '';
                });
                self.talentSummary = ko.computed(function() {
                    return self.talents.join(', ');
                });
                self.currentRankDescription = ko.computed(function() {
                    return self.rankDescriptions[self.points() - 1];
                });
                self.nextRankDescription = ko.computed(function() {
                    return self.rankDescriptions[self.points()];
                });

                //Methods
                self.addPoint = function() {
                    if (self.canAddPoints()) self.points(self.points() + 1);
                }
                self.removePoint = function() {
                    if (self.canRemovePoints()) self.points(self.points() - 1);
                }

                return self;
            }
            //VM for a simple hyperlink
        var Link = ns.Link = function(_e) {
            var e = _e || {};
            var self = function() {};

            //Basic properties
            self.label = e.label || (e.url || 'Learn more');
            self.url = e.url || 'javascript:void(0)';

            return self;
        }
    })(namespace('tft.dnd'));


    $(function() {

        if (isInvalidIEVersion())
            return;


        var vm = new tft.dnd.TalentTree(tft.dnd.data); //Make a new Talent Tree VM based on the data in tft.dnd.data.js
        vm.isOpen(true);
        ko.applyBindings(vm);

        //Allow a split second for binding before turning on animated transitions for the UI
        setTimeout(function() {
            $('.page').addClass('animated');
        }, 50);
    });

})(window.jQuery, window.ko);
</script>
</body>
</html>